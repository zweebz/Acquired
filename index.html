<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Acquired — Episodes</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=Instrument+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#041f21;
  --surface:#062b2c;
  --surface2:#073536;
  --border:#0b3a3a;
  --text:#e8f7f4;
  --text2:#9bcfc5;
  --accent:#35f8ca;
  --accent2:#29b597;
}
html{font-size:16px;scroll-behavior:smooth}
body{font-family:'Instrument Sans',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;line-height:1.6;-webkit-font-smoothing:antialiased}
::selection{background:var(--accent);color:var(--bg)}
.site-header{border-bottom:1px solid var(--border);padding:22px 0;position:sticky;top:0;z-index:100;background:rgba(4,31,33,.88);backdrop-filter:blur(16px)}
.header-inner{max-width:1100px;margin:0 auto;padding:0 22px;display:flex;align-items:center;justify-content:space-between;gap:14px;flex-wrap:wrap}
.logo{font-family:'DM Serif Display',serif;font-size:1.7rem;letter-spacing:-.02em;color:var(--accent)}
.logo small{color:var(--text2);font-family:'Instrument Sans',sans-serif;font-weight:600;font-size:.78rem;letter-spacing:.14em;text-transform:uppercase;margin-left:10px}
.header-stats{display:flex;gap:18px;align-items:center}
.stat{text-align:right}
.stat .val{font-family:'JetBrains Mono',monospace;font-size:1.1rem;color:var(--accent);font-weight:600}
.stat .label{font-size:.7rem;color:var(--text2);text-transform:uppercase;letter-spacing:.08em;margin-top:2px}

.main{max-width:1100px;margin:0 auto;padding:22px 22px 64px}
.controls{display:flex;gap:12px;flex-wrap:wrap;align-items:center;margin-bottom:14px}
.search-box{flex:1;min-width:260px;position:relative}
.search-box input{width:100%;padding:12px 14px 12px 42px;border-radius:12px;border:1px solid var(--border);background:var(--surface);color:var(--text);font-size:.95rem;outline:none}
.search-box input:focus{border-color:rgba(53,248,202,.55);box-shadow:0 0 0 3px rgba(53,248,202,.12)}
.search-box svg{position:absolute;left:14px;top:50%;transform:translateY(-50%);color:var(--text2)}

.select{padding:12px 12px;border-radius:12px;border:1px solid var(--border);background:var(--surface);color:var(--text);font-size:.9rem;outline:none}
.select:focus{border-color:rgba(53,248,202,.55);box-shadow:0 0 0 3px rgba(53,248,202,.12)}

.badge-row{display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap;margin:10px 0 18px}
.results-info{color:var(--text2);font-size:.9rem}
.note{color:var(--text2);font-size:.8rem}

.list{display:flex;flex-direction:column;gap:10px}
.card{background:linear-gradient(180deg, rgba(7,53,54,.9), rgba(6,43,44,.9));border:1px solid var(--border);border-radius:16px;padding:14px 14px 12px;transition:transform .12s ease,border-color .12s ease}
.card:hover{transform:translateY(-1px);border-color:rgba(53,248,202,.35)}
.row{display:flex;gap:10px;align-items:flex-start;justify-content:space-between}
.title{font-weight:700;font-size:1rem;line-height:1.3}
.meta{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-top:6px;color:var(--text2);font-size:.85rem}
.pill{font-family:'JetBrains Mono',monospace;font-size:.75rem;padding:4px 8px;border-radius:999px;border:1px solid rgba(53,248,202,.25);color:var(--accent);background:rgba(53,248,202,.06)}
.link{color:var(--accent);text-decoration:none;font-weight:650}
.link:hover{text-decoration:underline}
.desc{margin-top:10px;color:var(--text2);font-size:.92rem}

@media(max-width:768px){
  .header-inner{padding:0 16px}
  .main{padding:18px 16px 64px}
}
</style>
</head>
<body>
<header class="site-header">
  <div class="header-inner">
    <div class="logo">ACQUIRED<small>episodes</small></div>
    <div class="header-stats">
      <div class="stat"><div class="val" id="total-episodes">—</div><div class="label">Episodes</div></div>
      <div class="stat"><div class="val" id="total-industries">—</div><div class="label">Industries</div></div>
    </div>
  </div>
</header>

<div class="main">
  <div class="controls">
    <div class="search-box">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
      </svg>
      <input id="search" type="text" placeholder="Search episodes, companies, industries…">
    </div>

    <select class="select" id="industry-select" title="Filter by industry">
      <option value="">All industries</option>
    </select>

    <select class="select" id="sort-select" title="Sort">
      <option value="newest">Newest first</option>
      <option value="oldest">Oldest first</option>
      <option value="alpha">Title A–Z</option>
      <option value="industry">Industry A–Z</option>
    </select>
  </div>

  <div class="badge-row">
    <div class="results-info" id="results-info">Loading…</div>
    <div class="note">Source: <a class="link" href="https://www.acquired.fm/episodes" target="_blank" rel="noopener">acquired.fm/episodes</a> (via your Worker RSS proxy)</div>
  </div>

  <div class="list" id="list"></div>
</div>

<script>
const RSS_URL = "https://acquired.zachary-zweibel.workers.dev/rss";
const DATA=[];

let ALL_EPISODES = [];

// Build a lookup of company name -> industry for matching
const COMPANY_INDEX = (() => {
  const idx = [];
  for (const c of (DATA || [])) {
    if (!c || !c.name) continue;
    idx.push({
      name: c.name,
      key: c.name.toLowerCase(),
      industry: (c.industry || "").trim()
    });
  }
  // Prefer longest matches first (e.g., "JPMorgan Chase" before "JPMorgan")
  idx.sort((a,b) => b.key.length - a.key.length);
  return idx;
})();

function normalizeTitle(t) {
  return (t || "")
    .replace(/\s+/g, " ")
    .replace(/\u2013|\u2014/g, "-")
    .trim();
}

function inferCompanyAndIndustry(epTitle) {
  const t = (epTitle || "").toLowerCase();
  for (const c of COMPANY_INDEX) {
    if (t.includes(c.key)) {
      return {
        company: c.name,
        industry: c.industry || "Other"
      };
    }
  }
  return { company: null, industry: "Other" };
}

function formatDate(iso) {
  if (!iso) return "—";
  const d = new Date(iso);
  if (Number.isNaN(d.getTime())) return iso;
  return d.toLocaleDateString(undefined, { year:"numeric", month:"short", day:"numeric" });
}

async function loadEpisodesFromRss() {
  const xmlText = await fetch(RSS_URL, { cache: "no-store" }).then(r => r.text());
  const doc = new DOMParser().parseFromString(xmlText, "text/xml");
  const items = [...doc.querySelectorAll("item")];

  return items.map(item => {
    const title = normalizeTitle(item.querySelector("title")?.textContent || "Untitled");
    const link = (item.querySelector("link")?.textContent || "").trim();
    const pubDate = (item.querySelector("pubDate")?.textContent || "").trim();
    const description = (item.querySelector("description")?.textContent || "").trim();

    let date = "";
    const d = new Date(pubDate);
    if (!Number.isNaN(d.getTime())) {
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth() + 1).padStart(2, "0");
      const dd = String(d.getDate()).padStart(2, "0");
      date = `${yyyy}-${mm}-${dd}`;
    }

    const { company, industry } = inferCompanyAndIndustry(title);

    return {
      title,
      date,
      web: link,
      company,
      industry,
      blurb: description.replace(/<[^>]+>/g, "").slice(0, 260)
    };
  }).filter(e => e.title);
}

function buildIndustryOptions(episodes) {
  const select = document.getElementById("industry-select");
  const set = new Set();
  for (const e of episodes) set.add(e.industry || "Other");
  const industries = [...set].sort((a,b) => a.localeCompare(b));
  document.getElementById("total-industries").textContent = industries.length;

  // reset options
  select.innerHTML = '<option value="">All industries</option>';
  for (const ind of industries) {
    const opt = document.createElement("option");
    opt.value = ind;
    opt.textContent = ind;
    select.appendChild(opt);
  }
}

function applyFiltersAndRender() {
  const q = (document.getElementById("search").value || "").trim().toLowerCase();
  const ind = document.getElementById("industry-select").value;
  const sort = document.getElementById("sort-select").value;

  let out = ALL_EPISODES.slice();

  if (ind) out = out.filter(e => (e.industry || "Other") === ind);

  if (q) {
    out = out.filter(e => {
      const hay = `${e.title} ${e.company || ""} ${e.industry || ""}`.toLowerCase();
      return hay.includes(q);
    });
  }

  if (sort === "newest") {
    out.sort((a,b) => (b.date || "").localeCompare(a.date || ""));
  } else if (sort === "oldest") {
    out.sort((a,b) => (a.date || "").localeCompare(b.date || ""));
  } else if (sort === "alpha") {
    out.sort((a,b) => a.title.localeCompare(b.title));
  } else if (sort === "industry") {
    out.sort((a,b) => (a.industry || "Other").localeCompare(b.industry || "Other") || (b.date || "").localeCompare(a.date || ""));
  }

  renderList(out);
  document.getElementById("results-info").textContent = `${out.length} episodes shown`;
}

function renderList(episodes) {
  const list = document.getElementById("list");
  list.innerHTML = "";

  for (const e of episodes) {
    const card = document.createElement("div");
    card.className = "card";

    const title = document.createElement("div");
    title.className = "title";
    title.textContent = e.title;

    const meta = document.createElement("div");
    meta.className = "meta";

    const datePill = document.createElement("span");
    datePill.className = "pill";
    datePill.textContent = formatDate(e.date);

    const indPill = document.createElement("span");
    indPill.className = "pill";
    indPill.textContent = e.industry || "Other";

    meta.appendChild(datePill);
    meta.appendChild(indPill);

    if (e.company) {
      const cPill = document.createElement("span");
      cPill.className = "pill";
      cPill.textContent = e.company;
      meta.appendChild(cPill);
    }

    const link = document.createElement("a");
    link.className = "link";
    link.href = e.web || "#";
    link.target = "_blank";
    link.rel = "noopener";
    link.textContent = "Open episode page";

    const top = document.createElement("div");
    top.className = "row";
    const left = document.createElement("div");
    left.appendChild(title);
    left.appendChild(meta);
    top.appendChild(left);
    top.appendChild(link);

    card.appendChild(top);

    if (e.blurb) {
      const desc = document.createElement("div");
      desc.className = "desc";
      desc.textContent = e.blurb;
      card.appendChild(desc);
    }

    list.appendChild(card);
  }
}

function bindEvents() {
  document.getElementById("search").addEventListener("input", applyFiltersAndRender);
  document.getElementById("industry-select").addEventListener("change", applyFiltersAndRender);
  document.getElementById("sort-select").addEventListener("change", applyFiltersAndRender);
}

document.addEventListener("DOMContentLoaded", async () => {
  document.getElementById("results-info").textContent = "Syncing episodes…";
  try {
    ALL_EPISODES = await loadEpisodesFromRss();
  } catch (e) {
    console.error("RSS load failed:", e);
    document.getElementById("results-info").textContent = "Couldn't load episodes from RSS.";
    ALL_EPISODES = [];
  }

  document.getElementById("total-episodes").textContent = ALL_EPISODES.length;
  buildIndustryOptions(ALL_EPISODES);
  bindEvents();
  applyFiltersAndRender();
});
</script>
</body>
</html>
